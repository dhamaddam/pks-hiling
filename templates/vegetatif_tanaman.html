{% extends 'base.html' %}
{% block title %}Data Vegetatif Tanaman{% endblock %}

{% block content %}

<style>
  .top-toolbar {
    position: sticky;
    top: 0;
    z-index: 1000;
    background: #fff;
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap;
    border-bottom: 1px solid #ddd;
  }

  table.table {
    border-color: #dcdcdc;
  }

  thead th {
    background-color: #f8f9fa !important;
    vertical-align: middle !important;
    text-align: center;
  }

  tbody td {
    vertical-align: middle !important;
  }

  .table-responsive {
    max-height: 75vh;
    overflow-y: auto;
  }

  h2 {
    font-weight: 600;
    color: #2c3e50;
  }
</style>

<!-- üåø Toolbar -->
<div class="top-toolbar shadow-sm">
    <!-- üì§ Upload CSV -->
    <form action="{{ url_for('dashboard.upload_csv_vegetatif') }}" method="POST"
        enctype="multipart/form-data"
        class="d-flex align-items-center gap-2 mb-0">
        <label for="file" class="form-label mb-0"><strong>Upload CSV
                Vegetatif:</strong></label>
        <input type="file" name="file" id="file" accept=".csv"
            class="form-control form-control-sm" required>
        <button type="submit" class="btn btn-primary btn-sm">Upload</button>
    </form>

    <!-- üîç Filters + Export -->
    <form method="get" action="{{ url_for('vegetatif_tanaman') }}"
        class="d-flex align-items-center gap-2 mb-0">
        <label for="tahun_record" class="form-label mb-0">Tahun:</label>
        <select name="tahun_record" id="tahun_record"
            class="form-select form-select-sm" onchange="this.form.submit()">
            <option value>Semua</option>
            {% for t in tahun_list %}
            <option value="{{ t }}" {% if t|string == selected_tahun
                %}selected{% endif %}>{{ t }}</option>
            {% endfor %}
        </select>

        <label for="bulan_record" class="form-label mb-0">Bulan:</label>
        <select name="bulan_record" id="bulan_record"
            class="form-select form-select-sm" onchange="this.form.submit()">
            <option value>Semua</option>
            {% for b in bulan_list %}
            <option value="{{ b }}" {% if b|string == selected_bulan
                %}selected{% endif %}>
                {{
                ['Januari','Februari','Maret','April','Mei','Juni','Juli','Agustus','September','Oktober','November','Desember'][b|int
                - 1] }}
            </option>
            {% endfor %}
        </select>

        <a
            href="{{ url_for('dashboard.export_vegetatif_xls', tahun_record=selected_tahun, bulan_record=selected_bulan) }}"
            class="btn btn-success btn-sm">
            <i class="bi bi-file-earmark-excel"></i> Export Excel
        </a>
    </form>
</div>

<h2 class="mt-3 mb-3">Data Vegetatif Tanaman</h2>

<!-- üåæ Data Table -->
<div class="table-responsive">
    <table class="table table-bordered table-sm align-middle text-center"
        style="font-size: 12px;">
        <thead class="table-light">
            <!-- Row 1: Header groups -->
            <tr style="font-weight: 600; background-color: #f9f9f9;">
                <th colspan="5">üßæ 1. Informasi Waktu & Identitas Percobaan</th>
                <th colspan="3">üå± 2. Identitas Tanaman di Lapangan</th>
                <th colspan="6">üå¥ 3. Data Pertumbuhan Vegetatif</th>
                <th colspan="13">üåø 4. Data Komponen Daun (Leaflet)</th>
                <th colspan="6">üìê 5. Analisis Luas Daun</th>
            </tr>

            <!-- Row 2: Column headers -->
            <tr>
                <!-- 1Ô∏è‚É£ Informasi Waktu -->
                <th>Tahun</th>
                <th>Bulan</th>
                <th>Usia Tanam</th>
                <th>No Percobaan</th>
                <th>Crossing</th>

                <!-- 2Ô∏è‚É£ Posisi Tanaman -->
                <th>No Baris</th>
                <th>No Pokok</th>
                <th>ID Pokok</th>

                <!-- 3Ô∏è‚É£ Data Vegetatif -->
                <th>Tinggi Tanaman</th>
                <th>Lingkar Batang (LB)</th>
                <th>Jumlah Daun (Frond)</th>
                <th>Panjang Rachis</th>
                <th>Petiola L</th>
                <th>Petiola T</th>

                <!-- 4Ô∏è‚É£ Komponen Daun -->
                <th>P1</th><th>L1</th>
                <th>P2</th><th>L2</th>
                <th>P3</th><th>L3</th>
                <th>P4</th><th>L4</th>
                <th>P5</th><th>L5</th>
                <th>P6</th><th>L6</th>
                <th>HI</th>

                <!-- 5Ô∏è‚É£ Analisis Luas Daun -->
                <th>Avg P</th>
                <th>Avg L</th>
                <th>LA</th>
                <th>Tot LA</th>
                <th>LAI</th>
                <th>PCS</th>
            </tr>
        </thead>

        <tbody>
            {% if data %}
            {% for row in data %}
            <tr>
                {% for col in headers %}
                <td>{{ row[col] }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
            {% else %}
            <tr>
                <td colspan="32" class="text-muted text-center">
                    (Tidak ada data ditampilkan ‚Äî hanya header)
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- üìÑ Pagination -->
<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-3">
        {% if page > 1 %}
        <li class="page-item">
            <a class="page-link"
                href="{{ url_for('vegetatif_tanaman', page=page-1, tahun_record=selected_tahun, bulan_record=selected_bulan) }}">
                Previous
            </a>
        </li>
        {% endif %}

        <li class="page-item disabled">
            <span class="page-link">Halaman {{ page }} / {{ total_pages
                }}</span>
        </li>

        {% if page < total_pages %}
        <li class="page-item">
            <a class="page-link"
                href="{{ url_for('vegetatif_tanaman', page=page+1, tahun_record=selected_tahun, bulan_record=selected_bulan) }}">
                Next
            </a>
        </li>
        {% endif %}
    </ul>
</nav>

<!-- üîî Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
{% for category, msg in messages %}
<div class="alert alert-{{ category }} alert-dismissible fade show mt-3"
    role="alert">
    {{ msg }}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
{% endfor %}
{% endif %}
{% endwith %}

{% endblock %}
